# Ознакомление с кодом проекта

## Функциональность Mesto
- Загрузка фотографий.
- Удаление фотографий.
- Сбор и учет лайков под фото.
- Создание профиля и его редактирование.

## 1. Структура проекта

```
/architecture
├── /src
│     ├── /blocks
│     │     ├── /auth-form
│     │     │     ├── /__button
│     │     │     │     └── auth-form__button.css
│     │     │     ├── /__form
│     │     │     │     └── auth-form__form.css
│     │     │     ├── /__input
│     │     │     │     └── auth-form__input.css
│     │     │     ├── /__link
│     │     │     │     └── auth-form__link.css
│     │     │     ├── /__text
│     │     │     │     └── auth-form__text.css
│     │     │     ├── /__textfield
│     │     │     │     └── auth-form__textfield.css
│     │     │     ├── /__title
│     │     │     │     └── auth-form__title.css
│     │     │     └── auth-form.css
│     │     ├── /card
│     │     │     ├── /__delete-button
│     │     │     │     ├── /_hidden
│     │     │     │     │     └── card__delete-button_hidden.css
│     │     │     │     ├── /_visible
│     │     │     │     │     └── card__delete-button_visible.css
│     │     │     │     └── card__delete-button.css
│     │     │     ├── /__description
│     │     │     │     └── card__description.css
│     │     │     ├── /__image
│     │     │     │     └── card__image.css
│     │     │     ├── /__like-button
│     │     │     │     └── /_is-active
│     │     │     │     │     └── card__like-button_is-active.css
│     │     │     │     └── card__like-button.css
│     │     │     ├── /__like-count
│     │     │     │     └── card__like-count.css
│     │     │     ├── /__title
│     │     │     │     └── card__title.css
│     │     │     └── card.css
│     │     ├── /content 
│     │     │     └── content .css
│     │     ├── /footer 
│     │     │     ├── /__copyright
│     │     │     │     └── footer__copyright.css
│     │     │     └── footer .css
│     │     ├── /header 
│     │     │     ├── /__auth-link
│     │     │     │     └── header__auth-link.css
│     │     │     ├── /__logo
│     │     │     │     └── header__logo.css
│     │     │     ├── /__logout
│     │     │     │     └── header__logout.css
│     │     │     ├── /__user
│     │     │     │     └── header__user.css
│     │     │     ├── /__wrapper
│     │     │     │     └── header__wrapper.css
│     │     │     └── header .css
│     │     ├── /login
│     │     │     └── login .css
│     │     ├── /page
│     │     │     ├── /__content
│     │     │     │     └── page__content.css
│     │     │     ├── /__section
│     │     │     │     └── page__section.css
│     │     │     └── page .css
│     │     ├── /places
│     │     │     ├── /__item
│     │     │     │     └── places__item.css
│     │     │     ├── /__list
│     │     │     │     └── places__list.css
│     │     │     └── places .css
│     │     ├── /popup
│     │     │     ├── /__button
│     │     │     │     ├── /_disabled
│     │     │     │     │     └── popup__button_disabled.css
│     │     │     │     └── popup__button.css
│     │     │     ├── /__caption
│     │     │     │     └── popup__caption.css
│     │     │     ├── /__close
│     │     │     │     └── popup__close.css
│     │     │     ├── /__content
│     │     │     │     ├── /_content
│     │     │     │     │     └── popup__content_content_image.css
│     │     │     │     └── popup__content.css
│     │     │     ├── /__error
│     │     │     │     ├── /_visible
│     │     │     │     │     └── popup__error_visible.css
│     │     │     │     └── popup__error.css
│     │     │     ├── /__form
│     │     │     │     └── popup__form.css
│     │     │     ├── /__icon
│     │     │     │     └── popup__icon.css
│     │     │     ├── /__image
│     │     │     │     └── popup__image.css
│     │     │     ├── /__input
│     │     │     │     ├── /_type
│     │     │     │     │     └── popup__input_type_error.css
│     │     │     │     └── popup__input.css
│     │     │     ├── /__label
│     │     │     │     └── popup__label.css
│     │     │     ├── /__status-message
│     │     │     │     └── popup__status-message.css
│     │     │     ├── /__title
│     │     │     │     └── popup__title.css
│     │     │     ├── /__is-opened
│     │     │     │     └── popup__is-opened.css
│     │     │     ├── /__type
│     │     │     │     ├── popup_type_edit-avatar.css
│     │     │     │     └── popup_type_remove-card.css
│     │     │     └── popup .css 
│     │     ├── /profile
│     │     │     ├── /__add-button
│     │     │     │     └── profile__add-button.css
│     │     │     ├── /__description
│     │     │     │     └── profile__description.css
│     │     │     ├── /__edit-button
│     │     │     │     └── profile__edit-button.css
│     │     │     ├── /__image
│     │     │     │     └── profile__image.css
│     │     │     ├── /__info
│     │     │     │     └── profile__info.css
│     │     │     ├── /__title
│     │     │     │     └── profile__title.css
│     │     │     └── profile .css     
│     ├── /components
│     │     ├── AddPlacePopup.js  
│     │     ├── App.js
│     │     ├── Card.js 
│     │     ├── EditAvatarPopup.js
│     │     ├── EditProfilePopup.js
│     │     ├── Footer.js
│     │     ├── Header.js
│     │     ├── ImagePopup.js
│     │     ├── InfoTooltip.js
│     │     ├── Login.js 
│     │     ├── Main.js
│     │     ├── PopupWithForm.js
│     │     ├── ProtectedRoute.js    
│     │     └── Register.js        
│     ├── /contexts
│     │     └── CurrentUserContext.js               
│     ├── /images
│     │     ├── add-icon.svg
│     │     ├── avatar.jpg
│     │     ├── card_1.jpg
│     │     ├── card_2.jpg
│     │     ├── card_3.jpg
│     │     ├── close.svg
│     │     ├── delete-icon.svg
│     │     ├── edit-icon.svg
│     │     ├── error-icon.svg
│     │     ├── like-active.svg
│     │     ├── like-inactive.svg
│     │     ├── logo.svg
│     │     └── success-icon.svg             
│     ├── /utils
│     │     ├── api.js
│     │     └── auth.js                  
│     ├── /vendor
│     │     ├── /fonts
│     │     │     ├── Inter-Black.woff2
│     │     │     └── Inter-Regular.woff2
│     │     ├── fonts.css     
│     │     └── normalize.css
│     ├── index.css
│     ├── index.js
│     ├── logo.svg
│     ├── serviceWorker.js
│     └── setupTests.js
├── index.spec.js                       
└── package.json                        
```
Основные директории проекта:

**src** — корневая директория исходного кода приложения. В ней находятся все основные файлы и папки проекта:
- `blocks` — содержит стили компонентов, организованные по методологии БЭМ (Блок, Элемент, Модификатор). Здесь каждая папка соответствует отдельному блоку, а внутри находятся стили этого блока.
- `components` — содержит React-компоненты, используемые в приложении. Каждый компонент отвечает за определенную функциональность или часть интерфейса.
- `contexts` — хранит файлы контекстов. В данном случае это `CurrentUserContext.js`.
- `images` — содержит изображения и иконки, используемые в приложении.
- `utils` — утилитарные файлы и функции, такие как `api.js` для взаимодействия с сервером и `auth.js` для аутентификации пользователей.
- `vendor` — сторонние ресурсы, такие как шрифты (`fonts`) и стили сброса (`normalize.css`).
- `index.css` — главный файл стилей приложения.
- `index.js` — точка входа в приложение, где происходит рендеринг корневого компонента `App` в DOM.

## 2. Компоненты и модули
**Компоненты высшего уровня:**
- `App.js` — главный компонент приложения, который управляет состоянием и маршрутизацией. Он оборачивает всё приложение в контекст `CurrentUserContext.Provider` и содержит логику для авторизации, взаимодействия с API и управления состоянием модальных окон.
- `Header.js, Main.js, Footer.js` — компоненты, отвечающие за структуру страницы: заголовок, основной контент и подвал соответственно.

**Взаимодействие компонентов:**
- `App.js` импортирует и использует множество дочерних компонентов, передавая им необходимые пропсы и состояние. Например, `Main` получает пропсы `cards`, `onEditProfile`, `onAddPlace` и другие для управления соответствующими действиями.
- Контекст `CurrentUserContext` позволяет дочерним компонентам получать данные о текущем пользователе без необходимости пробрасывать их через все уровни компонентов.
- Модальные окна: компоненты, такие как `EditProfilePopup`, `AddPlacePopup`, `EditAvatarPopup`, `ImagePopup` и `InfoTooltip`, используются для отображения модальных окон. Они получают пропсы `isOpen`, `onClose` и другие для управления видимостью и поведением.

**Работа с API и авторизацией:**
- `api.js` — содержит классы и методы для взаимодействия с сервером: получение и обновление данных пользователя, загрузка фотографий, управление лайками и т.д.
- `auth.js` — отвечает за регистрацию, вход и проверку токена пользователя.

## 3. Маршрутизация
- В проекте используется библиотека `React Router` для настройки маршрутизации между разными страницами приложения. Маршруты определяются в файле App.js.
- Компонент `Switch` в `App.js` определяет маршруты:
  - для главной страницы (`/`), 
  - регистрации (`/signup`)
  - входа (`/signin`).
- `ProtectedRoute.js` — компонент, который защищает маршруты, требующие авторизации. Он проверяет, авторизован ли пользователь, и перенаправляет на страницу входа при необходимости.
- Хук useHistory из react-router-dom используется для программной навигации. Например, после успешной авторизации или регистрации пользователь перенаправляется на определенную страницу
- `InfoTooltip.js` — Компонент для отображения информационных сообщений пользователю, например, об успешной регистрации или ошибке. 
- `Header.js и Footer.js` — Отображаются на всех страницах приложения. `Header` может показывать информацию о пользователе или ссылки на вход/регистрацию в зависимости от состояния авторизации.

## 4. Зависимости проекта:
Файл `package.json` содержит список зависимостей и пакетов, используемых в проекте.

- **Основные библиотеки**:
    - React и React DOM для построения интерфейса.
    - React Router DOM для маршрутизации.
    - Testing Library для написания тестов.

- **Управление состоянием**:
    - Реализовано с помощью встроенных хуков и контекста React.

- **Тестирование**:
    - Используются библиотеки Testing Library и Playwright для написания юнит-тестов и энд-ту-энд тестирования.

- **Прочие утилиты**:
    - Dotenv для управления переменными окружения.
    - Wait-port для синхронизации запуска сервисов.

**P.S. о зависимостях:**

- Версии библиотек указаны с использованием символа каретки (`^`), что означает, что при установке будут использоваться последние минорные и патч-версии, совместимые с указанной мажорной версией.
- Отсутствие внешних библиотек для управления состоянием говорит о том, что приложение не требует сложного управления состоянием и достаточно возможностей, предоставляемых React "из коробки".

## 5. Утилиты и вспомогательные функции
В проекте есть две основные утилиты, расположенные в папке `utils`:

1. `api.js` — отвечает за взаимодействие с сервером по REST API для получения и изменения фото и информации о пользователе.
2. `auth.js` — управляет аутентификацией пользователей: регистрация, вход в систему и проверка токена.

### **Общие функции утилит и их роль в проекте**

- **`api.js`**:
  - **Централизация запросов к серверу**: все операции с данными осуществляются через методы этого класса, что упрощает код и делает его более читаемым.
  - **Унификация обработки ответов и ошибок**: в каждом методе используется единообразная обработка результатов, что облегчает отладку и поддержку.
  - **Повторное использование кода**: компоненты не дублируют логику запросов, а вызывают готовые методы из `api`.

- **`auth.js`**:
  - **Управление аутентификацией**: сосредоточивает всю логику, связанную с регистрацией, входом и проверкой токена пользователя.
  - **Безопасность**: хранит токен в `localStorage` и использует его в заголовках запросов для доступа к защищённым ресурсам.
  - **Упрощение компонентов**: компоненты `Register` и `Login` не содержат деталей реализации запросов, что делает их код более простым.

утилиты содержат всю логику взаимодействия с сервером, что позволяет легко вносить изменения в API без необходимости изменять компоненты.

## 6. Стили и их организация
`blocks` — содержит стили компонентов, организованные по методологии БЭМ (Блок, Элемент, Модификатор). Здесь каждая папка соответствует отдельному блоку, а внутри находятся стили этого блока.

# Разбиваем монолитный фронтенд на микрофронтенды
## Выполняем шаги согласно [схеме](https://code.s3.yandex.net/software-architect/Как%20разбить%20монолитный%20фронтенд%20на%20микрофронтенды.pdf)
## 1 этап. Предварительный анализ.
**Оценка сложности и масштаба приложения**

Проект представляет собой фронтенд-приложение "Mesto" на React с функциональностью социальной сети:
- Загрузка фотографий.
- Удаление фотографий.
- Сбор и учёт лайков под фотографиями.
- Создание и редактирование профиля пользователя.
- Аутентификация и авторизация пользователей.
- Отображение списка фотографий от разных пользователей.

Приложение разделено на компоненты, утилиты, контексты и стили, организованные по методологии БЭМ и структурированы в папке `src`.

Приложение имеет умеренную сложность с несколькими ключевыми областями функциональности, но при дальнейшем расширении может стать более сложным для поддержки одной командой.

**Формулирование цели перехода**

- **Цель**: Разделить монолитное фронтенд-приложение на несколько микрофронтендов, чтобы:

  - Обеспечить независимую разработку и развёртывание разных частей приложения.
  - Позволить нескольким независимым командам работать параллельно без конфликтов.
  - Улучшить масштабируемость и производительность отдельных модулей.
  - Облегчить поддержку и расширение приложения в будущем.

**Оценка опыта команды**

- **Технический опыт**:

  - Команда имеет опыт работы с React и понимает принципы построения компонентной архитектуры.
  - Знакома с паттернами проектирования, такими как Domain-Driven Design (DDD).
  - Имеет опыт работы с инструментами для реализации микрофронтендов (Single SPA).

## 2 этап. Определение бизнес-функций для разных команд.

Используя стратегию **«Изоляция»**, разделим приложение на микрофронтенды, которые могут существовать и обновляться независимо друг от друга.

1. **Микрофронтенд "Auth"**

    - **Функциональность**: Аутентификация и авторизация пользователей.
    - **Компоненты и файлы**:
        - `Login.js`
        - `Register.js`
        - `InfoTooltip.js`
        - Утилита `auth.js`
    - **Маршруты**:
        - `/signin` — страница входа.
        - `/signup` — страница регистрации.
    - **Особенности**: Полная изоляция логики аутентификации, независимость от других частей приложения.

2. **Микрофронтенд "Profile"**

    - **Функциональность**: Создание и редактирование профиля пользователя.
    - **Компоненты и файлы**:
        - `EditProfilePopup.js`
        - `EditAvatarPopup.js`
        - Контекст `CurrentUserContext.js`
    - **Маршруты**:
        - `/profile` — страница профиля пользователя.
    - **Особенности**: Управление данными пользователя, возможность независимого обновления профиля.

3. **Микрофронтенд "Gallery"**

    - **Функциональность**: Загрузка, отображение и управление фотографиями.
    - **Компоненты и файлы**:
        - `Main.js` (части, связанные с галереей)
        - `Card.js`
        - `AddPlacePopup.js`
        - `ImagePopup.js`
        - `PopupWithForm.js`
        - Утилита `api.js` (в части, связанной с фото)
    - **Маршруты**:
        - `/` — главная страница с галереей.
    - **Особенности**: Независимое управление фото, возможность обновления без влияния на другие микрофронтенды.

4. **Общие компоненты ("Shared Components")**

    - **Функциональность**: Общие элементы интерфейса и стили.
    - **Компоненты и файлы**:
        - `Header.js`
        - `Footer.js`
        - Стили из папок `blocks`, `vendor`
        - Изображения из папки `images`
    - **Особенности**: Общие компоненты могут быть вынесены в отдельный микрофронтенд или библиотеку, доступную всем остальным микрофронтендам.

## 3 этап: Выбор методов реализации, композиции и инструментов для создания микрофронтендов

1. **Метод интеграции микрофронтендов**: **Run time**

    - Микрофронтенды будут интегрироваться во время выполнения приложения, что позволяет динамически загружать и обновлять их без полной перезагрузки страницы.

2. **Метод композиции микрофронтендов**: **Клиентская композиция**

    - Используем клиентскую композицию, где браузер отвечает за динамическую загрузку каждого микрофронтенда.
    - Инструменты и техники при таком методе композии: **Single SPA**.
